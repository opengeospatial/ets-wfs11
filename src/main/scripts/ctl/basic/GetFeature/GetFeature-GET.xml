<?xml version="1.0" encoding="UTF-8"?>
<ctl:package xmlns="http://www.occamlab.com/ctl" xmlns:ctl="http://www.occamlab.com/ctl" xmlns:gml="http://www.opengis.net/gml" xmlns:ows="http://www.opengis.net/ows" xmlns:p="http://teamengine.sourceforge.net/parsers" xmlns:parsers="http://www.occamlab.com/te/parsers" xmlns:saxon="http://saxon.sf.net/" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <ctl:test name="wfs:run-GetFeature-GET">
        <param name="wfs.GetCapabilities.document"/>
        <ctl:assertion>Run test group for GetFeature requests using the GET method. Target endpoint is {$wfs.GetCapabilities.document//ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href}.</ctl:assertion>
        <ctl:code>
            <ctl:call-test name="wfs:GetFeature-output-format-default">
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-output-format-GML2">
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-output-format-gml-2.1.2">
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-extra-param">
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-result-type-results">
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <xsl:variable name="wfs.GetFeature.get.url">
                <xsl:value-of select="$wfs.GetCapabilities.document//ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href"/>
            </xsl:variable>
        <!-- IS: suspended due to engine issues
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc8.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc8.2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc8.3">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            -->
            <!-- IS: suspended due to engine behavior 
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc10.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
        -->
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc23.2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc23.3">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc23.4">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc26.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc30.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc30.2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <!--<ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc30.3"><ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/></ctl:call-test>-->
        <!-- IS: this test has been suspended. Further information below at test definition    
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc31.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
            </ctl:call-test>
        -->
        <!-- IS: this test has been suspended. Further information below at test definition    
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc32.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
            </ctl:call-test>
        -->
            <!--<ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc32.2"><ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/></ctl:call-test>-->
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc44.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <!--<ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc46.1"><ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/></ctl:call-test>-->
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc47.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc47.2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <!--<ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc48.1"><ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/></ctl:call-test>-->
        <!-- IS: this test has been suspended. Further information below at test definition   
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc50.1">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
            </ctl:call-test>
        -->
        <!-- IS: this test has been suspended. Further information below at test definition
            <ctl:call-test name="wfs:wfs-1.1.0-Basic-GetFeature-tc50.2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
            </ctl:call-test>
        -->
        <ctl:call-test name="wfs:GetFeature-output-format-default">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-output-format-GML2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-output-format-gml-2.1.2">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-extra-param">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
            <ctl:call-test name="wfs:GetFeature-result-type-results">
                <ctl:with-param name="wfs.GetFeature.get.url" select="$wfs.GetFeature.get.url"/>
                <ctl:with-param name="CAPABILITIES" select="$wfs.GetCapabilities.document"/>
            </ctl:call-test>
        </ctl:code>
    </ctl:test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc8.1
        IS: Changed, now uses first feature advertised in Capabilities response and BBOX full planet
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc8.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>A KVP parameter value that denotes a bounding box shall conform to the general syntax specified in subclause 10.2.3. If no CRS reference is provided, a service-defined default value must be assumed.</assertion>
        <comment>GetFeature with BBOX KVP parameter (with the CRS specified).  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) more than one feature is in the response.</comment>
        <link>ows-1.0.0-common-atc5</link>
        <link>OGC 05-008c1, 10.2.3, p.39</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </param>
                    <param name="bbox">-90,-180,90,180,urn:ogc:def:crs:EPSG::4326</param>
                    <param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:choose>
                        <xsl:when test="$request1/ows:ExceptionReport">
                            <ctl:call-test name="ctl:SchematronValidatingParser">
                                <ctl:with-param name="doc" select="$request1"/>
                                <ctl:with-param name="schema">/sch/ows/1.0.0/ExceptionReport.sch</ctl:with-param>
                                <ctl:with-param name="phase">InvalidParameterValuePhase</ctl:with-param>
                            </ctl:call-test>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                            <ctl:call-test name="ctl:assert-xpath">
                                <ctl:with-param name="expr" select="$expression"/>
                                <ctl:with-param name="doc" select="$request1"/>
                            </ctl:call-test>
                            <xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 1</xsl:variable>
                            <ctl:call-test name="ctl:assert-xpath">
                                <ctl:with-param name="expr" select="$expression"/>
                                <ctl:with-param name="doc" select="$request1"/>
                            </ctl:call-test>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc8.2
        IS: now uses typename as advertised in Capabilities response and maximum bounding box
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc8.2">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>A KVP parameter value that denotes a bounding box shall conform to the general syntax specified in clause 
      14.3.3 (and OWS Common 1.0, 10.2.3). If no CRS reference is specified for the BBOX, it is WGS 84 longitude-latitude 
      (http://www.opengis.net/def/crs/OGC/1.3/CRS84).</assertion>
        <comment>GetFeature with BBOX KVP parameter (without the CRS specified, CRS84 default). Pass if all of the following 
      conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; 
      (3) more than one feature is in the response.</comment>
        <link>ows-1.0.0-common-atc5</link>
        <link>OGC 05-008c1, 10.2.3, p.39</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </param>
                    <param name="bbox">-90,-180,90,180</param>
                    <param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:choose>
                        <xsl:when test="$request1/ows:ExceptionReport">
                            <ctl:call-test name="ctl:SchematronValidatingParser">
                                <ctl:with-param name="doc" select="$request1"/>
                                <ctl:with-param name="schema">/sch/ows/1.0.0/ExceptionReport.sch</ctl:with-param>
                                <ctl:with-param name="phase">InvalidParameterValuePhase</ctl:with-param>
                            </ctl:call-test>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                            <ctl:call-test name="ctl:assert-xpath">
                                <ctl:with-param name="expr" select="$expression"/>
                                <ctl:with-param name="doc" select="$request1"/>
                            </ctl:call-test>
                            <xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 1</xsl:variable>
                            <ctl:call-test name="ctl:assert-xpath">
                                <ctl:with-param name="expr" select="$expression"/>
                                <ctl:with-param name="doc" select="$request1"/>
                            </ctl:call-test>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc8.3
        IS: now uses first FeatureTypeName as advertised in Capabilities response
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc8.3">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>A KVP parameter value that denotes a bounding box shall conform to the general syntax specified in subclause 10.2.3. If no CRS reference is provided, a service-defined default value must be assumed.</assertion>
        <comment>GetFeature with BBOX KVP parameter (with the CRS not specified, service default expected).  The BBOX values would indicate no features in the response.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) no features are in the response.</comment>
        <link>ows-1.0.0-common-atc5</link>
        <link>OGC 05-008c1, 10.2.3, p.39</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </param>
                    <param name="bbox">0,0,0.01,0.01</param>
                    <param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:choose>
                        <xsl:when test="$request1/ows:ExceptionReport">
                            <ctl:call-test name="ctl:SchematronValidatingParser">
                                <ctl:with-param name="doc" select="$request1"/>
                                <ctl:with-param name="schema">/sch/ows/1.0.0/ExceptionReport.sch</ctl:with-param>
                                <ctl:with-param name="phase">InvalidParameterValuePhase</ctl:with-param>
                            </ctl:call-test>
                        </xsl:when>
                        <xsl:otherwise>
                            <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                            <ctl:call-test name="ctl:assert-xpath">
                                <ctl:with-param name="expr" select="$expression"/>
                                <ctl:with-param name="doc" select="$request1"/>
                            </ctl:call-test>
                            <xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) = 0</xsl:variable>
                            <ctl:call-test name="ctl:assert-xpath">
                                <ctl:with-param name="expr" select="$expression"/>
                                <ctl:with-param name="doc" select="$request1"/>
                            </ctl:call-test>
                        </xsl:otherwise>
                    </xsl:choose>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc10.1
        IS: Changed, now tests all FeatureTypeNames as advertised in the Capabilities response
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc10.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>A valid namespace binding expressed by the namespace parameter in a KVP string shall conform to the syntax specified in subclause 14.4.</assertion>
        <comment>GetFeature with the namespace KVP parameter (escaped by engine).  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document.</comment>
        <link>wfs-1.1.0-Basic-atc6</link>
        <link>OGC 04-094, 14.4, p.96</link>
        <code>
            <xsl:for-each select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType">
                <!-- variable required to select the next FeatureType per iteration -->
                <xsl:variable name="iteration" select="position()"/>
                <xsl:variable name="ftname">
                    <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[$iteration]/wfs:Name"/>
                </xsl:variable>
                <xsl:variable name="prefix">
                    <xsl:value-of select="substring-before($ftname , ':')"/>
                </xsl:variable>
                <xsl:variable name="namespace">
                    <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
                </xsl:variable>
                <xsl:variable name="request1">
                    <request>
                        <url>
                            <xsl:value-of select="$wfs.GetFeature.get.url"/>
                        </url>
                        <method>get</method>
                        <param name="service">WFS</param>
                        <param name="version">1.1.0</param>
                        <param name="request">GetFeature</param>
                        <ctl:param name="typename">
                            <xsl:value-of select="$ftname"/>
                        </ctl:param>
                        <ctl:param name="namespace">
                            <xsl:text>xmlns(</xsl:text>
                            <xsl:value-of select="$prefix"/>
                            <xsl:text>=</xsl:text>
                            <xsl:value-of select="$namespace"/>
                            <xsl:text>)</xsl:text>
                        </ctl:param>
                        <p:XMLValidatingParser.GMLSF1/>
                    </request>
                </xsl:variable>
                <xsl:choose>
                    <xsl:when test="not($request1/*)">
                        <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                        <ctl:fail/>
                    </xsl:when>
                    <xsl:otherwise>
                        <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                        <ctl:call-test name="ctl:assert-xpath">
                            <ctl:with-param name="expr" select="$expression"/>
                            <ctl:with-param name="doc" select="$request1"/>
                        </ctl:call-test>
                    </xsl:otherwise>
                </xsl:choose>
            </xsl:for-each>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc23.2
        IS: now uses first FeatureTypeName as advertised in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc23.2">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>The following query parameters are required for all KVP-encoded service requests except GetCapabilities: service, request, version.</assertion>
        <comment>GetFeature with a service 'WFS', version '1.1.0', and no request parameter.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an ows:ExceptionReport document.</comment>
        <link>ows-1.0.0-common-atc4</link>
        <link>OGC 05-008c1, 9.2.1, p.36 (Table 20)</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <p:XMLValidatingParser.OWS/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:call-test name="ctl:SchematronValidatingParser">
                        <ctl:with-param name="doc" select="$request1"/>
                        <ctl:with-param name="schema">/sch/ows/1.0.0/ExceptionReport.sch</ctl:with-param>
                        <ctl:with-param name="phase">MissingParameterValuePhase</ctl:with-param>
                    </ctl:call-test>
                    <xsl:if test="not(lower-case($request1//ows:Exception/@locator) = 'request')">
                        <ctl:message>FAILURE: ows:Exception/@locator is absent or does not identify the missing request attribute.</ctl:message>
                        <ctl:fail/>
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc23.3
        IS: now uses first FeatureTypeName as advertised in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc23.3">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>The following query parameters are required for all KVP-encoded service requests except GetCapabilities: service, request, version.</assertion>
        <comment>GetFeature with a version '1.1.0', request 'GetFeature' and no service.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an ows:ExceptionReport document.</comment>
        <link>ows-1.0.0-common-atc4</link>
        <link>OGC 05-008c1, 9.2.1, p.36 (Table 20)</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="request">GetFeature</param>
                    <param name="version">1.1.0</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <p:XMLValidatingParser.OWS/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:call-test name="ctl:SchematronValidatingParser">
                        <ctl:with-param name="doc" select="$request1"/>
                        <ctl:with-param name="schema">/sch/ows/1.0.0/ExceptionReport.sch</ctl:with-param>
                        <ctl:with-param name="phase">MissingParameterValuePhase</ctl:with-param>
                    </ctl:call-test>
                    <xsl:if test="not(lower-case($request1//ows:Exception/@locator) = 'service')">
                        <ctl:message>FAILURE: ows:Exception/@locator is absent or does not identify the missing service attribute.</ctl:message>
                        <ctl:fail/>
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc23.4
        IS: now uses first FeatureTypeName as advertised in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc23.4">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>The following query parameters are required for all KVP-encoded service requests except GetCapabilities: service, request, version.</assertion>
        <comment>GetFeature with a service 'WFS', request 'GetFeature' and no version.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an ows:ExceptionReport document.</comment>
        <link>ows-1.0.0-common-atc4</link>
        <link>OGC 05-008c1, 9.2.1, p.36 (Table 20)</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="request">GetFeature</param>
                    <param name="service">WFS</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//*[local-name() = 'ExceptionReport']</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc26.1
        IS: now uses valide feature type names as adertised in the GetCapabilitiesResponse. Only namespace of first FeatureTypeName is used!
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc26.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>A comma (',') shall be used to delimit list items within multi-valued parameters in KVP strings.</assertion>
        <comment>GetFeature with a typename parameter of multiple values, sperated by a comma.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) there is at least one of each of the requested feature types in the response.</comment>
        <link>ows-1.0.0-common-atc7</link>
        <link>OGC 05-008c1, 11.5.3, p.57</link>
        <code>
            <xsl:variable name="ftname1">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix1">
                <xsl:value-of select="substring-before($ftname1, ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace1">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix1]"/>
            </xsl:variable>
            <xsl:variable name="ftname2">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[2]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix2">
                <xsl:value-of select="substring-before($ftname2, ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace2">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix2]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname1"/>
                        <xsl:text>,</xsl:text>
                        <xsl:value-of select="$ftname2"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix1"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace1"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">(count(//sf:PrimitiveGeoFeature) &gt;= 4) and (count(//sf:AggregateGeoFeature) &gt;= 3)</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc30.1
        IS: now uses valide feature type names as adertised in the GetCapabilitiesResponse.
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc30.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>XPath 1.0 shall be used to address parts of an XML representation using ogc:PropertyName. Support for the AbbreviatedRelativeLocationPath construct is required; the position() function may appear in a predicate to refer to a child node by position relative to the context node.</assertion>
        <comment>GetFeature with a filter using the abbreviated local path predicate on the gml:description.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the requested feature is in the response as expected.</comment>
        <link>filter-1.1.0-common-atc2</link>
        <link>OGC 04-095, 6.3.2, p.5</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <param name="filter"><![CDATA[%3Cogc%3AFilter%20xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%22%20xmlns%3Aogc%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22%3E%3Cogc%3APropertyIsEqualTo%3E%3Cogc%3APropertyName%3Egml%3Adescription%3C%2Fogc%3APropertyName%3E%3Cogc%3ALiteral%3Edescription-f008%3C%2Fogc%3ALiteral%3E%3C%2Fogc%3APropertyIsEqualTo%3E%3C%2Fogc%3AFilter%3E]]></param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 1</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">//gml:description = 'description-f008'</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc30.2
        IS: now uses first feature type name as advertised in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc30.2">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>XPath 1.0 shall be used to address parts of an XML representation using ogc:PropertyName. Support for the AbbreviatedRelativeLocationPath construct is required; the position() function may appear in a predicate to refer to a child node by position relative to the context node.</assertion>
        <comment>GetFeature with a filter using the simplified position predicate ('[n]').  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the requested feature is in the response as expected.</comment>
        <link>filter-1.1.0-common-atc2</link>
        <link>OGC 04-095, 6.3.2, p.5</link>
        <code>
             <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <ctl:param name="typename">
                            <xsl:value-of select="$ftname"/>
                        </ctl:param>
                        <ctl:param name="namespace">
                            <xsl:text>xmlns(</xsl:text>
                            <xsl:value-of select="$prefix"/>
                            <xsl:text>=</xsl:text>
                            <xsl:value-of select="$namespace"/>
                            <xsl:text>)</xsl:text>
                        </ctl:param>
                    <param name="filter"><![CDATA[%3Cogc%3AFilter%20xmlns%3Aogc%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22%20xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%22%3E%3Cogc%3APropertyIsEqualTo%3E%3Cogc%3APropertyName%3Egml%3Adescription%5B1%5D%3C%2Fogc%3APropertyName%3E%3Cogc%3ALiteral%3Edescription-f001%3C%2Fogc%3ALiteral%3E%3C%2Fogc%3APropertyIsEqualTo%3E%3C%2Fogc%3AFilter%3E]]></param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 1</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">//gml:description = 'description-f001'</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--<test name="wfs:wfs-1.1.0-Basic-GetFeature-tc30.3"><param name="wfs.GetFeature.get.url"/><assertion>XPath 1.0 shall be used to address parts of an XML representation using ogc:PropertyName. Support for the AbbreviatedRelativeLocationPath construct is required; the position() function may appear in a predicate to refer to a child node by position relative to the context node.</assertion><comment>GetFeature with a filter using the position predicate ('position()').  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the requested feature is in the response as expected.</comment><link>filter-1.1.0-common-atc2</link><link>OGC 04-095, 6.3.2, p.5</link><code><xsl:variable name="request1"><request><url><xsl:value-of select="$wfs.GetFeature.get.url"/></url><method>get</method><param name="service">WFS</param><param name="version">1.1.0</param><param name="request">GetFeature</param><param name="typename">sf:PrimitiveGeoFeature</param><param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param><param name="filter"><![CDATA[<ogc:Filter%20xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsEqualTo><ogc:PropertyName>*[position()=1]</ogc:PropertyName><ogc:Literal>description-f001</ogc:Literal></ogc:PropertyIsEqualTo></ogc:Filter>]]></param><p:XMLValidatingParser.GMLSF1/></request></xsl:variable><xsl:choose><xsl:when test="not($request1/*)"><ctl:message>FAILURE: Missing or invalid response entity.</ctl:message><ctl:fail/></xsl:when><xsl:otherwise><xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test><xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 1</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test><xsl:variable name="expression">//gml:description = 'description-f001'</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test></xsl:otherwise></xsl:choose></code></test>-->
    <!--
        wfs-1.1.0-Basic-GetFeature-tc31.1
        IS: This test has been suspended, because it is very complex to understand what kind of filter could be applied. This would require to read the DescribeFeatureTypeResponse and filter for one of the feature types. 
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc31.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>A valid filter expression must conform to the content model declared for the ogc:Filter element.</assertion>
        <comment>GetFeature with a correctly structured filter element. Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document.</comment>
        <link>filter-1.1.0-common-atc3</link>
        <link>OGC 04-095, 7.2, p.9</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <param name="filter"><![CDATA[%3Cogc%3AFilter%20xmlns%3Asf%3D%22http%3A%2F%2Fcite.opengeospatial.org%2Fgmlsf%22%20xmlns%3Aogc%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22%3E%3Cogc%3APropertyIsGreaterThan%3E%3Cogc%3APropertyName%3Esf%3AintProperty%3C%2Fogc%3APropertyName%3E%3Cogc%3ALiteral%3E100%3C%2Fogc%3ALiteral%3E%3C%2Fogc%3APropertyIsGreaterThan%3E%3C%2Fogc%3AFilter%3E]]></param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc32.1
        IS: This test has been suspended, because it is very complex to understand what kind of filter could be applied. This would require to read the DescribeFeatureTypeResponse and filter for one of the feature types. More specific: One would need to extract one of the elements of that feature type, extract the type of this element, and query for it. The type is one of a long list, e.g. xs:int, xs:double..., gml:MultiSurfacePropertyType...
        One option might be to query against the gml:id, i.e. use a filter such as gml:id is not XXXXX
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc32.1">
        <param name="wfs.GetFeature.get.url"/>
        <assertion>An ogc:Literal element may include simple or complex content. If a child element appears it may belong to any target namespace, but a top-level declaration for the item must be available.</assertion>
        <comment>GetFeature with a string-valued literal in the filter.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the requested feature shall be in the response.</comment>
        <link>filter-1.1.0-common-atc4</link>
        <link>OGC 04-095, 14.2, p.17</link>
        <code>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">sf:PrimitiveGeoFeature</param>
                    <param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param>
                    <param name="filter"><![CDATA[%3Cogc%3AFilter%20xmlns%3Agml%3D%22http%3A%2F%2Fwww.opengis.net%2Fgml%22%20xmlns%3Aogc%3D%22http%3A%2F%2Fwww.opengis.net%2Fogc%22%3E%3Cogc%3APropertyIsEqualTo%3E%3Cogc%3APropertyName%3Egml%3Aname%3C%2Fogc%3APropertyName%3E%3Cogc%3ALiteral%3Ename-f002%3C%2Fogc%3ALiteral%3E%3C%2Fogc%3APropertyIsEqualTo%3E%3C%2Fogc%3AFilter%3E]]></param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 1</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                    <xsl:variable name="expression">//gml:name = 'name-f002'</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--<test name="wfs:wfs-1.1.0-Basic-GetFeature-tc32.2"><param name="wfs.GetFeature.get.url"/><assertion>An ogc:Literal element may include simple or complex content. If a child element appears it may belong to any target namespace, but a top-level declaration for the item must be available.</assertion><comment>GetFeature with a complex literal in the filter, which doesn't exist.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) there are no features in the response.</comment><link>filter-1.1.0-common-atc4</link><link>OGC 04-095, 14.2, p.17</link><code><xsl:variable name="request1"><request><url><xsl:value-of select="$wfs.GetFeature.get.url"/></url><method>get</method><param name="service">WFS</param><param name="version">1.1.0</param><param name="request">GetFeature</param><param name="typename">sf:PrimitiveGeoFeature</param><param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param><param name="filter"><![CDATA[<ogc:Filter%20xmlns:gml="http://www.opengis.net/gml"%20xmlns:ogc="http://www.opengis.net/ogc"><ogc:PropertyIsEqualTo><ogc:PropertyName>gml:name</ogc:PropertyName><ogc:Literal><wfs:Native vendorId="ASDF" safeToIgnore="true"/></ogc:Literal></ogc:PropertyIsEqualTo></ogc:Filter>]]></param><p:XMLValidatingParser.GMLSF1/></request></xsl:variable><xsl:choose><xsl:when test="not($request1/*)"><ctl:message>FAILURE: Missing or invalid response entity.</ctl:message><ctl:fail/></xsl:when><xsl:otherwise><xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test><xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) = 0</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test></xsl:otherwise></xsl:choose></code></test>-->
    <!--
        wfs-1.1.0-Basic-GetFeature-tc44.1
        IS: Test now uses first feature type as defined in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc44.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>Version number specified in a given request must correspond to a version supported by the service.</assertion>
        <comment>GetFeature with missing version parameter. Pass if the response includes an exception report.</comment>
        <link>wfs-1.1.0-Basic-atc1</link>
        <link>OGC 04-094, 6.2.3, p.9</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="request">GetFeature</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:if test="not($request1//*[@exceptionCode = 'MissingParameterValue'])">
                        <ctl:message>FAILURE: ows:Exception/@exceptionCode is absent or does not specify 'MissingParameterValue'.</ctl:message>
                        <ctl:fail/>
                    </xsl:if>
                    <xsl:if test="not($request1//*[lower-case(@locator) = 'version'])">
                        <ctl:message>FAILURE: ows:Exception/@locator is absent or does not identify the missing version parameter value.</ctl:message>
                        <ctl:fail/>
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc46.1"><param name="wfs.GetFeature.get.url"/><assertion>KVP URI encoding must be properly escaped for escape and special characters.</assertion><comment>GetFeature by featureType a feature using escaped characters ( = %C3%A9 in URI encoding).  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the response must have at least the expected features (correct feature type).</comment><link>wfs-</link><link></link><code><xsl:variable name="request1"><request><url><xsl:value-of select="$wfs.GetFeature.get.url"/></url><method>get</method><param name="service">WFS</param><param name="version">1.1.0</param><param name="request">GetFeature</param><param name="typename">sf:EntitGnrique</param><param name="typename">sf:Entit%C3%A9G%C3%A9n%C3%A9rique</param><param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param><p:XMLValidatingParser.GMLSF1/></request></xsl:variable><xsl:choose><xsl:when test="not($request1/*)"><ctl:message>FAILURE: Missing or invalid response entity.</ctl:message><ctl:fail/></xsl:when><xsl:otherwise><xsl:variable name="expression">//wfs:FeatureCollection</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test><xsl:variable name="expression">(count(//gml:featureMember) + count(//gml:featureMembers/*)) &gt;= 2</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test><xsl:variable name="expression">count(//sf:EntitGnrique) &gt;= 2</xsl:variable><ctl:call-test name="ctl:assert-xpath"><ctl:with-param name="expr" select="$expression"/><ctl:with-param name="doc" select="$request1"/></ctl:call-test></xsl:otherwise></xsl:choose></code></test>-->
    <!--
        wfs-1.1.0-Basic-GetFeature-tc47.1
        IS: namespace set to namespace of first feature type advertised in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc47.1">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>IIf a request is unrecognizable or the service cannot process the request, a valid exception report must be returned.</assertion>
        <comment>GetFeature with an incorrect typename ('sf:Asdf') in the query.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an ows:ServiceException document.</comment>
        <link>wfs-1.1.0-Basic-atc10</link>
        <link>OGC 04-094, 7.7, p. 23</link>
        <code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">XXXXXXXXXXX</param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <p:XMLValidatingParser.OWS/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//ows:ExceptionReport</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc47.2
        IS: changed to use valid feature type as advertised in Capabilities document
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc47.2">
        <param name="wfs.GetFeature.get.url"/>
        <param name="CAPABILITIES"/>
        <assertion>IIf a request is unrecognizable or the service cannot process the request, a valid exception report must be returned.</assertion>
        <comment>GetFeature with an incorrect propertyname ('sf:asdfProperty') requested in the query.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an ows:ServiceException document.</comment>
        <link>wfs-1.1.0-Basic-atc10</link>
        <link>OGC 04-094, 7.7, p. 23</link>
        <code>
             <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <param name="propertyname">XXXXXXXXXXXX</param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <p:XMLValidatingParser.OWS/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1/*)">
                    <ctl:message>FAILURE: Missing or invalid response entity.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="expression">//ows:ExceptionReport</xsl:variable>
                    <ctl:call-test name="ctl:assert-xpath">
                        <ctl:with-param name="expr" select="$expression"/>
                        <ctl:with-param name="doc" select="$request1"/>
                    </ctl:call-test>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
<test name="wfs:wfs-1.1.0-Basic-GetFeature-tc48.1"><param name="wfs.GetFeature.get.url"/><assertion>Correctly select the objects specified by the list of supplied identifiers. The  identification scheme is service-specific, but valid identifiers must substitute for ogc:_Id.</assertion><comment>GetFeature to first get more than one feature id (gml:id), then another GetFeature filtering on the gml:ids.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the response shall have at least the two feature members expected from the request.</comment><link>filter-1.1.0-objectid-atc2</link><link>OGC 04-095, 11.1, p.14</link><code><xsl:variable name="request1"><request><url><xsl:value-of select="$wfs.GetFeature.get.url"/></url><method>get</method><param name="service">WFS</param><param name="version">1.1.0</param><param name="request">GetFeature</param><param name="typename">sf:Entit%C3%A9G%C3%A9n%C3%A9rique</param><param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param><p:XMLValidatingParser.GMLSF1/></request></xsl:variable><xsl:choose><xsl:when test="not($request1//wfs:FeatureCollection)"><ctl:message>FAILURE: Expected valid wfs:FeatureCollection.</ctl:message><ctl:fail/></xsl:when><xsl:otherwise><xsl:variable name="gml.id1"><xsl:value-of select="$request1//sf:EntitGnrique[1]/@gml:id" /></xsl:variable><xsl:variable name="gml.id2"><xsl:value-of select="$request1//sf:EntitGnrique[2]/@gml:id" /></xsl:variable><xsl:variable name="request2"><request><url><xsl:value-of select="$wfs.GetFeature.get.url"/></url><method>get</method><param name="service">WFS</param><param name="version">1.1.0</param><param name="request">GetFeature</param><param name="featureid"><xsl:value-of select="encode-for-uri($gml.id1)"/>,<xsl:value-of select="encode-for-uri($gml.id2)"/></param><param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param></request></xsl:variable><xsl:choose><xsl:when test="not($request2/*)"><ctl:message>FAILURE: Missing or invalid response entity.</ctl:message><ctl:fail/></xsl:when><xsl:otherwise><xsl:for-each select="$request2//sf:EntitGnrique"><xsl:variable name="id"><xsl:value-of select="@gml:id"/></xsl:variable><xsl:if test="empty(index-of(($gml.id1, $gml.id2), $id))"><ctl:message>FAILURE: Unexpected gml:id value (<xsl:value-of select="$id"/>)</ctl:message><ctl:fail/></xsl:if></xsl:for-each></xsl:otherwise></xsl:choose></xsl:otherwise></xsl:choose></code></test>-->
    <!--
        wfs-1.1.0-Basic-GetFeature-tc50.1
        IS: Test has been suspended, as sort criteria depends on feature type characteristics. Difficult to handle generic case
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc50.1">
        <param name="wfs.GetFeature.get.url"/>
        <assertion>When the SortBy parameter is used the resulting feature set must be properly sorted according to the sort criteria.</assertion>
        <comment>GetFeature for all PrimitiveGeoFeature sorting by the intProperty in ascending order (default if no 'A' or 'D' present).  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the response shall have the features sorted by the proper feature property in the described ascending or descending manner.</comment>
        <link>wfs-</link>
        <link>OGC 04-094, 14.7.3.1, p.100</link>
        <code>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">sf:PrimitiveGeoFeature</param>
                    <param name="sortby">
                        <xsl:value-of select="encode-for-uri('sf:intProperty')"/>
                    </param>
                    <param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1//wfs:FeatureCollection)">
                    <ctl:message>[FAILURE] Expected wfs:FeatureCollection in response.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="features" select="$request1//sf:PrimitiveGeoFeature"/>
                    <xsl:variable name="f1.int" select="xsd:integer($features[1]/sf:intProperty)"/>
                    <xsl:variable name="f2.int" select="xsd:integer($features[2]/sf:intProperty)"/>
                    <xsl:variable name="f3.int" select="xsd:integer($features[3]/sf:intProperty)"/>
                    <xsl:if test="($f1.int gt $f2.int) or ($f2.int gt $f3.int)">
                        <ctl:message>FAILURE: Features are not sorted by sf:intProperty in ascending order.</ctl:message>
                        <ctl:fail/>
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        wfs-1.1.0-Basic-GetFeature-tc50.2
        IS: Test suspended due to complexity. 
    -->
    <test name="wfs:wfs-1.1.0-Basic-GetFeature-tc50.2">
        <param name="wfs.GetFeature.get.url"/>
        <assertion>When the SortBy parameter is used the resulting feature set must be properly sorted according to the sort criteria.</assertion>
        <comment>GetFeature for all PrimitiveGeoFeature sorting by the intProperty in descending order.  Pass if all of the following conditions are true: (1) the response is schema valid; (2) the root document is an wfs:FeatureCollection document; (3) the response shall have the features sorted by the proper feature property in the described ascending or descending manner.</comment>
        <link>wfs-</link>
        <link>OGC 04-094, 14.7.3.1, p.100</link>
        <code>
            <xsl:variable name="request1">
                <request>
                    <url>
                        <xsl:value-of select="$wfs.GetFeature.get.url"/>
                    </url>
                    <method>get</method>
                    <param name="service">WFS</param>
                    <param name="version">1.1.0</param>
                    <param name="request">GetFeature</param>
                    <param name="typename">sf:PrimitiveGeoFeature</param>
                    <param name="sortby">
                        <xsl:value-of select="encode-for-uri('sf:intProperty D')"/>
                    </param>
                    <param name="namespace">xmlns(sf=http://cite.opengeospatial.org/gmlsf)</param>
                    <p:XMLValidatingParser.GMLSF1/>
                </request>
            </xsl:variable>
            <xsl:choose>
                <xsl:when test="not($request1//wfs:FeatureCollection)">
                    <ctl:message>[FAILURE] Expected wfs:FeatureCollection in response.</ctl:message>
                    <ctl:fail/>
                </xsl:when>
                <xsl:otherwise>
                    <xsl:variable name="features" select="$request1//sf:PrimitiveGeoFeature"/>
                    <xsl:variable name="f1.int" select="xsd:integer($features[1]/sf:intProperty)"/>
                    <xsl:variable name="f2.int" select="xsd:integer($features[2]/sf:intProperty)"/>
                    <xsl:variable name="f3.int" select="xsd:integer($features[3]/sf:intProperty)"/>
                    <xsl:if test="($f1.int lt $f2.int) or ($f2.int lt $f3.int)">
                        <ctl:message>FAILURE: Features are not sorted by sf:intProperty in descending order.</ctl:message>
                        <ctl:fail/>
                    </xsl:if>
                </xsl:otherwise>
            </xsl:choose>
        </code>
    </test>
    <!--
        GetFeature-output-format-default
        IS: no changes
    -->
    <ctl:test name="wfs:GetFeature-output-format-default">
        <ctl:param name="CAPABILITIES"/>
        <ctl:assertion>The MIME returned for a GetFeature request where no specific output format is requested is &quot;text/xml; subtype=gml/3.1.1&quot;.</ctl:assertion>
        <ctl:comment/>
        <ctl:link>OGC 04-094, 6.4, p.11</ctl:link>
        <ctl:code>
            <xsl:variable name="RESPONSE">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href"/>
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="request">GetFeature</ctl:param>
                    <ctl:param name="service">WFS</ctl:param>
                    <ctl:param name="version">1.1.0</ctl:param>
                    <param name="typename">
                        <xsl:value-of select="wfs:encode($CAPABILITIES/wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name,'UTF-8')"/>
                    </param>
                    <parsers:HTTPParser>
                        <parsers:parse>
                            <parsers:NullParser/>
                        </parsers:parse>
                    </parsers:HTTPParser>
                </ctl:request>
            </xsl:variable>
            <xsl:variable name="header" select="$RESPONSE/response/headers/header[@name='Content-Type']"/>
            <xsl:variable name="content-type" select="substring-before(concat($header, ';'), ';')"/>
            <xsl:if test="not($content-type = 'text/xml' and contains($header, 'subtype=gml/3.1.1'))">
                <ctl:fail/>
            </xsl:if>
        </ctl:code>
    </ctl:test>
    <!--
        GetFeature-output-format-GML2
        IS: no changes
    -->
    <ctl:test name="wfs:GetFeature-output-format-GML2">
        <ctl:param name="CAPABILITIES"/>
        <ctl:assertion>When output format GML2 is supported, the MIME returned for a GetFeature request where the output format requested is GML2 is &quot;text/xml; subtype=gml/2.1.2&quot;.</ctl:assertion>
        <ctl:comment/>
        <ctl:link>OGC 04-094, 6.4, p.11</ctl:link>
        <ctl:code>
            <xsl:choose>
                <xsl:when test="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:Parameter[@name='outputFormat' and ows:Value='GML2']">
                    <xsl:variable name="RESPONSE">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href"/>
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="request">GetFeature</ctl:param>
                            <ctl:param name="service">WFS</ctl:param>
                            <ctl:param name="version">1.1.0</ctl:param>
                            <param name="typename">
                                <xsl:value-of select="wfs:encode($CAPABILITIES/wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name,'UTF-8')"/>
                            </param>
                            <ctl:param name="outputformat">GML2</ctl:param>
                            <parsers:HTTPParser>
                                <parsers:parse>
                                    <parsers:NullParser/>
                                </parsers:parse>
                            </parsers:HTTPParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:variable name="header" select="$RESPONSE/response/headers/header[@name='Content-Type']"/>
                    <xsl:variable name="content-type" select="substring-before(concat($header, ';'), ';')"/>
                    <xsl:if test="not($content-type = 'text/xml' and contains($header, 'subtype=gml/2.1.2'))">
                        <ctl:fail/>
                    </xsl:if>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>output format GML2 is not supported</ctl:message>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--
        GetFeature-output-format-gml-2.1.2
        IS: no changes
    -->
    <ctl:test name="wfs:GetFeature-output-format-gml-2.1.2">
        <ctl:param name="CAPABILITIES"/>
        <ctl:assertion>When output format &quot;text/xml; subtype=gml/2.1.2&quot; is supported, the MIME returned for a GetFeature request where the output format requested is &quot;text/xml; subtype=gml/2.1.2&quot; is &quot;text/xml; subtype=gml/2.1.2&quot;.</ctl:assertion>
        <ctl:comment/>
        <ctl:link>OGC 04-094, 6.4, p.11</ctl:link>
        <ctl:code>
            <xsl:choose>
                <xsl:when test="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:Parameter[@name='outputFormat' and ows:Value='text/xml; subtype=gml/2.1.2']">
                    <xsl:variable name="RESPONSE">
                        <ctl:request>
                            <ctl:url>
                                <xsl:value-of select="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href"/>
                            </ctl:url>
                            <ctl:method>get</ctl:method>
                            <ctl:param name="request">GetFeature</ctl:param>
                            <ctl:param name="service">WFS</ctl:param>
                            <ctl:param name="version">1.1.0</ctl:param>
                            <param name="typename">
                                <xsl:value-of select="wfs:encode($CAPABILITIES/wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name,'UTF-8')"/>
                            </param>
                            <ctl:param name="outputformat">
                                <xsl:value-of select="wfs:encode('text/xml; subtype=gml/2.1.2','UTF-8')"/>
                            </ctl:param>
                            <parsers:HTTPParser>
                                <parsers:parse>
                                    <parsers:NullParser/>
                                </parsers:parse>
                            </parsers:HTTPParser>
                        </ctl:request>
                    </xsl:variable>
                    <xsl:variable name="header" select="$RESPONSE/response/headers/header[@name='Content-Type']"/>
                    <xsl:variable name="content-type" select="substring-before(concat($header, ';'), ';')"/>
                    <xsl:if test="not($content-type = 'text/xml' and contains($header, 'subtype=gml/2.1.2'))">
                        <ctl:fail/>
                    </xsl:if>
                </xsl:when>
                <xsl:otherwise>
                    <ctl:message>output format &quot;text/xml; subtype=gml/2.1.2&quot; is not supported</ctl:message>
                </xsl:otherwise>
            </xsl:choose>
        </ctl:code>
    </ctl:test>
    <!--
        GetFeature-extra-param
        IS: changed to use correct namespace as advertised in Capabilities response
    -->
    <ctl:test name="wfs:GetFeature-extra-param">
        <ctl:param name="CAPABILITIES"/>
        <ctl:assertion>A valid HTTP Get request with an extra parameter not recognized by the WFS does not return an exception.</ctl:assertion>
        <ctl:comment/>
        <ctl:link>OGC 04-094, 14.3.4, p.95</ctl:link>
        <ctl:code>
                        <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="RESPONSE">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href"/>
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="request">GetFeature</ctl:param>
                    <ctl:param name="service">WFS</ctl:param>
                    <ctl:param name="version">1.1.0</ctl:param>
                    <ctl:param name="extra">Unknown</ctl:param>
                    <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <parsers:HTTPParser>
                        <parsers:parse>
                            <parsers:HTTPParser/>
                        </parsers:parse>
                    </parsers:HTTPParser>
                </ctl:request>
            </xsl:variable>
            <xsl:if test="$RESPONSE//ows:Exception/*">
                <ctl:fail/>
            </xsl:if>
        </ctl:code>
    </ctl:test>
    <!--
        GetFeature-result-type-results
        IS: changed to use correct namespace as advertised in Capabilities response
    -->
    <ctl:test name="wfs:GetFeature-result-type-results">
        <ctl:param name="CAPABILITIES"/>
        <ctl:assertion>A GetFeature request with resultType=Results returns the actual features, not just the count of number of hits.</ctl:assertion>
        <ctl:comment/>
        <ctl:link>OGC 04-094, 9.3, p.38</ctl:link>
        <ctl:code>
            <xsl:variable name="ftname">
                <xsl:value-of select="$CAPABILITIES//wfs:FeatureTypeList/wfs:FeatureType[1]/wfs:Name"/>
            </xsl:variable>
            <xsl:variable name="prefix">
                <xsl:value-of select="substring-before($ftname , ':')"/>
            </xsl:variable>
            <xsl:variable name="namespace">
                <xsl:value-of select="$CAPABILITIES/namespace::*[name()=$prefix]"/>
            </xsl:variable>
            <xsl:variable name="RESPONSE">
                <ctl:request>
                    <ctl:url>
                        <xsl:value-of select="$CAPABILITIES/ows:OperationsMetadata/ows:Operation[@name='GetFeature']/ows:DCP/ows:HTTP/ows:Get/@xlink:href"/>
                    </ctl:url>
                    <ctl:method>get</ctl:method>
                    <ctl:param name="request">GetFeature</ctl:param>
                    <ctl:param name="service">WFS</ctl:param>
                    <ctl:param name="version">1.1.0</ctl:param>
                    <ctl:param name="resultType">results</ctl:param>
                     <ctl:param name="typename">
                        <xsl:value-of select="$ftname"/>
                    </ctl:param>
                    <ctl:param name="namespace">
                        <xsl:text>xmlns(</xsl:text>
                        <xsl:value-of select="$prefix"/>
                        <xsl:text>=</xsl:text>
                        <xsl:value-of select="$namespace"/>
                        <xsl:text>)</xsl:text>
                    </ctl:param>
                    <parsers:HTTPParser>
                        <parsers:parse>
                            <parsers:HTTPParser/>
                        </parsers:parse>
                    </parsers:HTTPParser>
                </ctl:request>
            </xsl:variable>
            <xsl:if test="not(($RESPONSE//gml:featureMember) or ($RESPONSE//gml:featureMembers/*))">
                <ctl:fail/>
            </xsl:if>
            <xsl:if test="$RESPONSE//wfs:FeatureCollection/@numberOfFeatures and not($RESPONSE//wfs:FeatureCollection/@numberOfFeatures = count($RESPONSE//gml:featureMember) + count($RESPONSE//gml:featureMembers/*))">
                <ctl:fail/>
            </xsl:if>
        </ctl:code>
    </ctl:test>
</ctl:package>